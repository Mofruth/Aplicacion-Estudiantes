<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Cambiar Nota</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/profesor.css') }}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
  <div class="main-layout">
    <!-- Sidebar Persistente -->
    <aside class="sidebar">
      <div class="logo"><i class="fas fa-chalkboard-teacher"></i> Profesor</div>
      <nav>
        <a href="{{ url_for('profesor_dashboard') }}" class="{% if 'dashboard' in request.path %}active{% endif %}">
          <i class="fas fa-home"></i> Dashboard
        </a>
        <a href="/profesor/obtener_estudiantes" class="{% if 'obtener_estudiantes' in request.path %}active{% endif %}">
          <i class="fas fa-users"></i> Obtener Estudiantes
        </a>
        <a href="/profesor/asignar_nota" class="{% if 'asignar_nota' in request.path %}active{% endif %}">
          <i class="fas fa-edit"></i> Asignar Nota
        </a>
        <a href="/profesor/cambiar_nota" class="{% if 'cambiar_nota' in request.path %}active{% endif %}">
          <i class="fas fa-sync-alt"></i> Cambiar Nota
        </a>
        <a href="/profesor/enviar_notificacion" class="{% if 'enviar_notificacion' in request.path %}active{% endif %}">
          <i class="fas fa-envelope"></i> Notificar
        </a>
      </nav>
      <a href="/logout" class="btn-logout"><i class="fas fa-sign-out-alt"></i> Cerrar Sesi√≥n</a>
    </aside>

    <!-- Main Content -->
    <main class="content">
      <div class="container">
    <h1>Cambiar Nota</h1>

    <form method="POST" action="{{ url_for('cambiar_nota') }}">
      <label for="id_materia">Selecciona una materia:</label>
      <select name="id_materia" id="id_materia" required style="padding:8px 12px; border-radius:6px; min-width:fit-content;">
        <option value="" disabled selected>-- Selecciona una materia --</option>
        {% for materia in materias %}
          <option value="{{ materia['id'] }}">{{ materia['nombre'] }}</option>
        {% endfor %}
      </select>
      <div style="display:flex; justify-content:center; margin-top:16px;">
        <button type="submit" style="padding:12px 28px; border-radius:8px; min-width:fit-content; background:#4facfe; color:white; border:none; width:fit-content; font-size:1.15rem; font-weight:500;">Buscar Estudiantes</button>
      </div>
    </form>

    {% if estudiantes %}
    <form method="POST" action="{{ url_for('cambiar_nota') }}">
      <input type="hidden" name="id_materia" value="{{ request.form.get('id_materia') }}">
      <table>
        <thead>
          <tr>
            <th>Nombre del Estudiante</th>
            <th>Correo</th>
            <th>Nota</th>
            <th>Comentario</th>
          </tr>
        </thead>
        <tbody>
          {% for estudiante in estudiantes %}
          <tr>
            <td>{{ estudiante['estudiante'] }}</td>
            <td>{{ estudiante['correo'] }}</td>
            <td>
              <input class="nota-cambiar-input" type="number" name="nueva_nota[]" min="0" max="100" required>
              <input type="hidden" name="id_estudiante[]" value="{{ estudiante['id'] }}">
            </td>
            <td>
              <textarea class="comentario-cambiar-textarea" name="comentario[]" rows="3" placeholder="Escribe un comentario..."></textarea>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      <div style="display:flex; justify-content:center; margin-top:16px;">
        <button type="submit" style="padding:12px 28px; border-radius:8px; min-width:fit-content; background:#4facfe; color:white; border:none; width:fit-content; font-size:1.15rem; font-weight:500;">Cambiar Nota</button>
      </div>
    </form>
    {% else %}
      <p>No hay estudiantes inscritos en esta materia.</p>
    {% endif %}

        <div style="display: flex; justify-content: center; margin-top: 2rem;">
          <a href="{{ url_for('profesor_dashboard') }}" style="text-decoration: none;">
            <div style="display:flex; justify-content:center; margin-top:20px;">
              <button type="button" class="btn-back" style="padding:12px 28px; border-radius:8px; min-width:fit-content; background:#747d87; color:white; border:none; width:fit-content; font-size:1.15rem; font-weight:500;">Volver al Dashboard</button>
            </div>
          </a>
        </div>
      </div>
    </main>
  </div>
</body>
</html>
